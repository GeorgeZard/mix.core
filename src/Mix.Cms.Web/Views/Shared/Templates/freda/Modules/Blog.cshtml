@using Mix.Cms.Lib
@using Mix.Cms.Lib.Services
@model Mix.Cms.Lib.ViewModels.MixModules.ReadMvcViewModel

@{
    string assetFolder = Mix.Cms.Lib.MixCmsHelper.GetAssetFolder(ViewBag.culture);
    string templateFolder = Mix.Cms.Lib.MixCmsHelper.GetTemplateFolder(ViewBag.culture);

    var attributes_set_data = Mix.Cms.Lib.ViewModels.MixAttributeSetDatas.ReadMvcViewModel.Repository.GetModelListAsync("Priority", Mix.Heart.Enums.MixHeartEnums.DisplayDirection.Asc, 0, 20);
    var attributes_set_data_categories = attributes_set_data.Result.Data.Items.Where(p => p.AttributeSetName == "sys_category").OrderBy(o => o.Priority);

    var attributes_set_value = Mix.Cms.Lib.ViewModels.MixAttributeSetValues.ReadMvcViewModel.Repository.GetModelListAsync("Priority", Mix.Heart.Enums.MixHeartEnums.DisplayDirection.Asc, 0, 20);
    var attributes_set_value_categories = attributes_set_value.Result.Data.Items.Where(p => p.AttributeSetName == "sys_category").OrderBy(o => o.Priority);

    var posts = await Mix.Cms.Lib.ViewModels.MixPosts.ReadViewModel.Repository.GetModelListAsync("CreatedDateTime", Mix.Heart.Enums.MixHeartEnums.DisplayDirection.Desc, 200, 0);

}

<!-- blog section -->
<section class="yb-section yb-section-padding" id="blog">
    <div class="yb-section-point-wrapper">
        <div class="uk-container">
            <div class="yb-section-point">
                <span>Blog</span>
            </div>
        </div>
    </div>
    <div class="uk-container">
        <h2 class="yb-section-title uk-heading-line"><span>@(Mix.Cms.Lib.Services.MixService.TranslateString("blog_latest_news", ViewBag.culture))</span></h2>

        <div data-uk-grid class="uk-grid-medium yb-margin-top-1 yb-margin-bottom-2">

            @foreach (var attr in attributes_set_data_categories.OrderBy(o => o.Priority))
            {
                if (attributes_set_value_categories.Any(p => p.DataId == attr.Id && p.AttributeFieldName == "title"))
                {
                    var attribute_set_title = attributes_set_value_categories.FirstOrDefault(p => p.DataId == attr.Id && p.AttributeFieldName == "title").StringValue;
                    if (attributes_set_value_categories.FirstOrDefault(p => p.DataId == attr.Id && p.AttributeFieldName == "type").StringValue == "Post")
                    {
                        @foreach (var post in posts.Data.Items.Where(p => p.ListCategory.Contains(attribute_set_title)))
                        {
                            <div class="uk-width-1-3@m uk-width-1-2@s">
                                <a href="/post/@post.Id/@post.SeoName">
                                    <div class="yb-blog-item uk-background-cover" data-src="@post.Image" data-uk-img>
                                        <div class="uk-overlay uk-position-cover"> </div>
                                        <div class="uk-overlay uk-position-top">
                                            <span class="uk-badge">@post.Excerpt</span>
                                        </div>
                                        <div class="uk-overlay uk-position-bottom">
                                            <h5 class="yb-blog-item-title uk-text-truncate">@post.Title</h5>
                                            <div class="yb-blog-item-meta">
                                                <div>
                                                    <span>@post.CreatedDateTime</span>
                                                </div>
                                                @*<div>
                                                        <span data-uk-icon="comment"></span> 120
                                                    </div>
                                                    <div>
                                                        <span data-uk-icon="heart"></span> 89
                                                    </div>*@
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        }
                    }
                }
            }
        </div>


        @*<h5 class="uk-heading-line uk-text-right uk-text-bold">
                <a href="#" class="uk-link-heading">
                    @(Mix.Cms.Lib.Services.MixService.TranslateString("blog_see_more", ViewBag.culture))
                    <span data-uk-icon="icon:arrow-right; ratio: 2"></span>
                </a>
            </h5>*@
    </div>
</section><!-- end blog section -->
